# 架构导轨：防止 AI 在大型项目中失控的治理艺术

> **核心命题：** 在 Vibe Coding 时代，代码是耗材，但**架构是生命线**。如果开发者不提供明确的工程架构，AI 的多次迭代将演变成一场灾难。

## 1. 为什么 AI 会让大项目崩溃？

AI 生成代码的逻辑是**“局部最优”**。它在写一个函数时，可能并不知道你全局的错误处理规范或组件分层逻辑。
- **孤岛效应**：AI 可能会为了实现功能，随手在 `src/` 下建一个新文件夹，或者引入一个项目中本不存在的库。
- **熵增爆发**：随着项目增大，AI 提供的“快速方案”会不断打破既有的工程契约，导致重构成本指数级上升。

## 2. 焊死“工程骨架” (The Engineering Skeleton)

在让 AI 动手前，开发者必须像架构师一样，在 `AGENT.md` 或 `CLAUDE.md` 中预设好“导轨”：

### 2.1 物理层导轨：文件夹约束
不要让 AI 决定文件放哪。明确定义：
- `src/components/common/`：只放原子级组件。
- `src/hooks/`：所有的业务逻辑必须封装成 Hook。
- `src/services/`：所有的 API 请求必须在此层，禁止在页面内直接发起 fetch。

### 2.2 逻辑层导轨：契约约束
- **错误处理**：统一使用 `Result<T, E>` 模式或特定的 `try-catch` 包装器。
- **状态管理**：明确规定全局状态与局部状态的界限。
- **命名规范**：例如，所有的异步函数必须以 `fetch` 或 `sync` 开头。

## 3. 架构审查流：Plan Mode 的妙用

利用 Claude Code 或 Cursor 的 **Plan Mode** 作为架构哨卡：

1.  **提交意图**：告诉 AI 需求，但禁止它改代码。
2.  **审查路径**：要求 AI 说出：“我打算修改哪些文件？我打算如何组织这块新逻辑？”
3.  **对齐导轨**：如果 AI 的计划违背了既有架构（比如它想在 Page 里写 SQL），立即喝止并修正。

## 4. 动态治理：从“补丁”到“重构”

正如 [《Agent 宪法》](../../AGENT_CONSTITUTION_UNIVERSAL.md) 所言，当架构开始变乱时，**不要写兼容代码**。
- **局部重刷**：如果某个模块的架构乱了，直接让 AI 按照最新的架构导轨，把整个模块重新刷一遍。
- **架构演进**：随着需求变化，主动更新 `AGENT.md` 中的架构定义，让 AI 意识到“规则变了”。

---

## 5. 结论：架构师是 AI 时代的最后一道防线

一个合格的 10x 开发者，50% 的时间应该花在**定义规则（Defining Rails）**上，30% 的时间在**审查路径（Reviewing Paths）**，最后只有 20% 的时间在微调 AI 生成的代码。

> **🚀 深度探索：** 我们已经开启了 [**《架构治理 (Architectural Governance) 专项指南》**](../architecture-governance/README.mdx)，为你提供物理层、逻辑层与流程层的全方位治理框架。
