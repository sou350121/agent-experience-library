# 05 进阶：揭秘 Agent 的大脑与手脚

当你已经能用 Cursor 写出小工具后，你可能会好奇：**AI 到底是怎么“动”起来的？为什么它有时聪明得像天才，有时又会陷入死循环？**

理解 Agent 的底层设计，能让你从“使用者”进化为“指挥官”。

## 1. 核心逻辑：ReAct 循环 (思考 -> 行动 -> 观察)

AI Agent 不是一次性写完代码的。它在后台跑着一个循环，就像人类解决问题的过程：

```text
    +---------------------------------------+
    |           [ 1. Reasoning (思考) ]      | <--- "我需要先读一下这个文件"
    +------------------+--------------------+
                       |
                       v
    +---------------------------------------+
    |           [ 2. Acting (行动) ]        | <--- 调用工具 (如 read_file)
    +------------------+--------------------+
                       |
                       v
    +---------------------------------------+
    |           [ 3. Observing (观察) ]      | <--- "哦，文件内容我看完了，没发现问题"
    +------------------+--------------------+
                       |
                       +---- 循环，直到任务完成 ----+
```

*   **小白启示**：当你看到 AI 在“转圈”时，它正在进行这个循环。如果它卡住了，通常是因为“观察”到的结果跟它想的不一样。

## 2. 为什么 @ 符号如此重要？ (上下文预处理)

在提示词里用 `@file` 或 `@folder`，本质上是在**手动干预 AI 的“感官”**。

*   **省钱/省 Token**：如果不加 `@`，AI 可能会盲目搜索整个项目（浪费大量电力和配额）。
*   **减少幻觉**：直接把正确的文件塞到 AI 手里，它就不需要凭空猜测你的函数名是怎么写的。

## 3. 子智能体 (SubAgent)：精英小分队

在处理复杂任务时，主 AI 会派出“子智能体”（如 Codebase Investigator）。

```text
    [ 主 Agent ] (总指挥)
         |
         +---- [ 子 Agent A ] (只负责搜代码)
         |
         +---- [ 子 Agent B ] (只负责跑测试)
```

*   **上下文隔离**：子 Agent 在一个小房间里干活，干完只把结果汇报给总指挥。这样不会让主对话框里塞满无关的搜索废话，保证了主大脑的清醒。

## 4. MCP：AI 的“万能插头”

MCP (Model Context Protocol) 让 AI 拥有了连接真实世界的能力。

*   **工具扩展**：通过 MCP，你可以让 Cursor 连接你的 Google Calendar、Slack 甚至你的私有数据库。
*   **为什么 Claude Code 推出 Skills？**：为了解决工具太多的问题。AI 不再一次性带上所有工具箱，而是像“点外卖”一样，需要哪个 Skill 才临时加载哪个。

## 5. 规约驱动开发 (Spec-driven)：先写合同，再动工

这是目前 AI 编程的顶级实战方法：**不要直接说“给我写个登录页面”**。

### 正确步骤 (OpenSpec 模式)：
1.  **Proposal (提案)**：让 AI 先写一份 `proposal.md`，描述它打算怎么改。
2.  **Spec (规约)**：定义好具体的 `tasks.md`（任务清单）和 `spec.md`（技术规范）。
3.  **Apply (执行)**：AI 根据你确认过的“合同”进行施工。

```text
    [ 想法 ] -> [ 提案(Proposal) ] -> [ 确认 ] -> [ 施工(Apply) ]
```

**为什么这样做？** 
因为 AI 容易越写越乱。有了规约（Spec），它就被按在了“轨道”上，即使是大型项目也不会崩盘。

## 6. 未来展望：从“盲目信任”到“数学证明”

现在的 AI 再聪明，本质上也是在“猜”概率。在写个简单的网页时，猜错了没关系；但如果是**无人车转向、银行放贷、手术机器人开刀**，我们不能靠运气。

未来的 AI Agent 将会进化出一个核心能力：**zkML (零知识证明 + 机器学习)**。

*   **现在**：AI 给你一个答案，你只能选择“信”或者“不信”。
*   **未来**：AI 给你一个答案的同时，会附带一份**“逻辑收据”**（数学证明）。
*   **意义**：这份收据能向你证明：这个决定是严格按照预设的模型和数据算出来的，没有被黑客篡改、没有中途偷懒、没有逻辑跳跃。

**总结**：未来的 Agent 不再需要你“盲目相信”，而是通过数学让你“放心使用”。

---
> 恭喜你！你已经读完了所有基础和进阶课程。
> 现在，去 [提示词库](../prompt-library/README.md) 挑选一个你的“神笔”开始创作吧！

