# 01 组织模型与角色分工（Operating Model & Roles）

> 目标：把 Agent 从“一个聊天窗口”升级为“可管理的组织”。先定义角色，再定义交接，最后定义门禁。

---

## 🧠 核心洞见

> **“Agent 管理学 = 角色清晰 + 交接清晰 + 责任可追溯。”**

当你有多个 Agent（或同一 Agent 多轮迭代）时，混乱往往来自两件事：
- **谁负责做决定**（Decider）
- **谁对结果负责**（Accountable）

---

## 1. 最小组织结构（推荐）

把整个交付拆成 6 个可复用角色：

1. **Commander（指挥官/Owner）**
   - 负责：目标、优先级、范围控制（Do/Don’t）。
   - 交付物：一句话目标 + 约束 + 验收标准（Acceptance Criteria）。

2. **Planner（规划官/Spec Writer）**
   - 负责：把意图变成可执行 Spec（需求、设计、任务拆分）。
   - 交付物：`requirements.md`（EARS）+ `design.md` + `tasks.md`。

3. **Implementer（执行官/Builder）**
   - 负责：在约束内写代码、补文档、改配置。
   - 交付物：可运行实现 + 最小必要测试/验证步骤。

4. **Reviewer（审查官/QA）**
   - 负责：质量门禁（正确性、安全、可维护性、回归风险）。
   - 交付物：审查清单结论 + 必改项（Blockers）+ 可选项（Nice-to-have）。

5. **Guard（守门人/Security & Policy）**
   - 负责：权限、凭证、执行环境、依赖引入与攻击面。
   - 交付物：风险分级 + 允许/拒绝的执行清单（Allowlist）。

6. **Runner（跑手/Automation）**
   - 负责：执行重复流程（lint/test/build/docs sync/release）。
   - 交付物：可复现的命令、CI 结果、日志与产物链接。

> 实操建议：**同一个 Agent 可以扮演多个角色，但一次只扮演一个**（避免“又写又审又批准”的自嗨闭环）。

---

## 2. 交接契约（Handoff Contracts）

### 2.1 Commander → Planner
- 输入：目标、范围、硬约束（时间/成本/合规/依赖禁止）。
- 输出必须包含：
  - EARS 需求（可验证）
  - 最小验收标准（必须是可运行/可测的）

### 2.2 Planner → Implementer
- 输入：requirements/design/tasks
- 输出必须包含：
  - 修改文件清单
  - 验证步骤（如何证明“真的做对了”）

### 2.3 Implementer → Reviewer
- 输入：PR/变更集 + 自测结果
- 输出必须包含：
  - Blockers（必须改）
  - Risk notes（可能回归点）

### 2.4 Reviewer/Guard → Runner
- 输入：允许执行的命令与环境约束
- 输出必须包含：
  - 可复现命令 + 日志 + 产物（如有）

---

## 3. 门禁（Gates）：让系统可控

最小门禁建议（按风险递增）：

1. **Spec Gate**：没有验收标准，不开始写代码。
2. **Diff Gate**：改动超过阈值（文件数/行数）必须引入 Reviewer 角色。
3. **Exec Gate**：涉及依赖安装/脚本执行/权限提升，必须引入 Guard 角色。
4. **Release Gate**：线上/主分支合并前必须有回滚方案（见 04）。

---

## 4. 可复制模板（直接复制使用）

### 4.1 Commander 指令模板

```text
目标：
- ...

不做（范围控制）：
- ...

硬约束：
- 时间：
- 风险：
- 禁止项（依赖/权限/外部访问）：

验收标准（必须可验证）：
- [ ] ...
```

### 4.2 Reviewer 审查模板

```text
结论：✅可合并 / ❌不可合并

Blockers（必须改）：
1) ...

风险点（可能回归）：
- ...

建议（可选）：
- ...

验证建议：
- ...
```

